name: okd-3.11
version: 3.11
install_playbooks:
  - name: 1-uninstall-install
    alias: openshift-ansible/playbooks/adhoc/uninstall.yml
  - name: 2-validate-install
    alias: playbooks/validate.yml
  - name: 3-prequisites-install
    alias: openshift-ansible/playbooks/prerequisites.yml
  - name: 4-deploy-cluster-install
    alias: openshift-ansible/playbooks/deploy_cluster.yml
upgrade_playbooks:
  - name: 1-prepaire-upgrade
    alias: prepare.yml
  - name: 2-run-prequisites-upgrade
    alias: openshift-ansible/playbooks/upgrade.yml
uninstall_playbooks:
  - name: 1-uninstall
    alias: openshift-ansible/playbooks/uninstall.yml



configs:
  - name: openshift_master_cluster_public_hostname
    alias: 域名
    type: Input
    default: lb.fit2openshift.com
    required: true
    help_text: 访问的fit2openshift的域名

  - name: openshift_master_default_subdomain
    alias: 子域名后缀
    type: Input
    default: apps.test.example.com
    required: true
    help_text: 部署app后service的域名

  - name: openshift_cluster_monitoring_operator_install
    alias: 集群监控
    type: Checkbox
    required: true
    help_text: 部署集群监控插件

  - name: openshift_metrics_install_metrics
    alias: 集群指标
    type: Checkbox
    required: true
    help_text: 部署集群指标采集插件

  - name: openshift_logging_install_logging
    alias: 日志分析
    type: Checkbox
    require: true
    help_text: 部署日志分析插件


# template public roles
roles:
  - name: etcd
    children:
      - masters
    meta:
      hidden: true
  - name: OSEv3
    children:
      - masters
      - nodes
      - etcd
      - lb
    meta:
      hidden: true
    vars:

templates:
  - name: 单节点
    roles:
      - name: masters
        vars:
          openshift_node_group_name: node-config-all-in-one
        meta:
          hidden: false
          node_vars:
            - name: "docker_storage"
              verbose: "docker 存储卷"
              comment: "请选择空白块存储设备,注意此操作将抹除所有数据！"
              placeholder: "eg:/dev/sdb"
              type: "Select"
              options: "$volumes"
              require: true

          requires:
            nodes_require:
              - '='
              - 1
            volumes_require:
              - name: "system"
                verbose: "系统卷:"
                minimal: 50
                excellent: 100
                comment: "系统卷，用于运行操作系统"
                unit: "GB"
              - name: "data"
                verbose: "数据卷:"
                minimal: 100
                excellent: 500
                comment: "数据卷,用于存储docker数据"
                unit: "GB"
            device_require:
              - name: "cpu_core"
                verbose: "CPU 核心数"
                minimal: 4
                excellent: 8
                comment: "无"
                unit: "个"
              - name: "memory_size"
                verbose: "内存大小"
                minimal: 8
                excellent: 16
                unit: "GB"
                comment: "无"

      - name: nodes
        children:
          - masters
        meta:
          hidden: true

#  - name: 一主多节点
#    roles:
#      - name: masters
#        vars:
#          openshift_node_group_name: node-config-master
#        meta:
#          hidden: false
#          requires:
#            nodes_require:
#              - '='
#              - 1
#            volumes_require:
#              - system:
#                  verbose: "系统卷:"
#                  minimal: 50
#                  excellent: 100
#                  blank: false
#              - data:
#                  verbose: "数据卷:"
#                  minimal: 100
#                  excellent: 500
#                  blank: false
#            device_require:
#              - cpu_core:
#                  verbose: "CPU 核心数"
#                  minimal: 4
#                  excellent: 8
#              - memory_size:
#                  verbose: "内存大小"
#                  minimal: 8
#                  excellent: 16
#      - name: cumpute
#        meta:
#          hidden: false
#          requires:
#            nodes_require:
#              - '>'
#              - 3
#            volumes_require:
#              - system:
#                  verbose: "系统卷:"
#                  minimal: 50
#                  excellent: 100
#                  blank: false
#              - data:
#                  verbose: "数据卷:"
#                  minimal: 100
#                  excellent: 500
#                  blank: false
#            device_require:
#              - cpu_core:
#                  verbose: "CPU 核心数"
#                  minimal: 2
#                  excellent: 4
#              - memory_size:
#                  verbose: "内存大小"
#                  minimal: 8
#                  excellent: 16
#      - name: infra
#        meta:
#          hidden: false
#          requires:
#            nodes_require:
#              - '>'
#              - 3
#            volumes_require:
#              - system:
#                  verbose: "系统卷:"
#                  minimal: 50
#                  excellent: 100
#                  blank: false
#              - data:
#                  verbose: "数据卷:"
#                  minimal: 100
#                  excellent: 200
#                  blank: false
#              - gluster:
#                  verbose: "gluster FS卷:"
#                  minimal: 500
#                  excellent: 1000
#                  blank: true
#            device_require:
#              - cpu_core:
#                  verbose: "CPU 核心数"
#                  minimal: 2
#                  excellent: 4
#              - memory_size:
#                  verbose: "内存大小"
#                  minimal: 8
#                  excellent: 16
#      - name: nodes
#        children:
#          - masters
#          - compute
#          - infra
#        meta:
#          hidden: true

#  - name: 多主多节点
#    roles:
#      - name: masters
#        vars:
#          openshift_node_group_name: node-config-master
#        meta:
#          hidden: false
#          nodes_require:
#            - '>'
#            - 1
#      - name: compute
#        vars:
#          openshift_node_group_name: node-config-compute
#        meta:
#          hidden: false
#          nodes_require:
#            - '>'
#            - 2
#      - name: lb
#        meta:
#          hidden: false
#          nodes_require:
#            - '='
#            - 1
#      - name: nodes
#        children:
#          - masters
#          - compute
#          - infra
#        meta:
#          hidden: true
